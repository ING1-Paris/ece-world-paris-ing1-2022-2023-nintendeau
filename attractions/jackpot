#include <stdio.h>
#include <allegro.h>
#include <time.h>


int main(int argc, char *argv[])
{
    srand(time(NULL));
    int cblanc, crouge, cbleu, cnoir;
    int vblanc = 1, vrouge = 2,vbleu = 3;
    int fin;
    int nbrTicket = 5 ;
    int dernierAppui = 0;

    allegro_init();
    install_keyboard();
    install_mouse();

    set_color_depth(desktop_color_depth());
    if (set_gfx_mode(GFX_AUTODETECT_WINDOWED,800,600,0,0)!=0)
    {
        allegro_message("prb gfx mode");
        allegro_exit();
        exit(EXIT_FAILURE);
    }
    show_mouse(screen);

    // Avoir une couleur (ici du blanc)
    cblanc=makecol(255,255,255);
    crouge=makecol(255,0,0);
    cbleu=makecol(0,0,255);
    cnoir= makecol(0,0,0);

    rectfill(screen,570,300,690,310,makecol(0,128,0 ));
    textprintf_ex(screen,font,572,302,makecol(255,0,0),makecol(0,255,0),"lancer le jeu ");
    fin=0;

    textprintf_ex(screen, font, 300, 500, cblanc, -1, "il vous reste %d tickets", nbrTicket);


    for(int i = 0 ; i < 3 ; i++) {
        int choix = rand() % 3 + 1;
        if (choix == vbleu) {
            rectfill(screen, 240 + i * 110, 240, 340 + i *  110, 340, cbleu);
        } else if (choix == vblanc) {
            rectfill(screen, 240 + i * 110, 240, 340 + i *  110, 340, cblanc);
        } else if (choix == vrouge){
            rectfill(screen, 240 + i * 110, 240, 340 + i *  110, 340, crouge);
        }
    }

    while (!fin) {

        if (nbrTicket <= 0) {
            rectfill(screen, 300, 500, 700, 530, cnoir);
            textprintf_ex(screen, font, 300, 500, cblanc, -1, "Vous n'avez plus de tickets !");
            rest(1000);
            fin = 1;
        }
        if (mouse_b & 1 && mouse_x <= 690 && mouse_x >= 570 && mouse_y <= 310 && mouse_x >= 300) {
            if (time(NULL) - dernierAppui >= 1) {
                dernierAppui = time(NULL);

                nbrTicket = nbrTicket - 1;

                for(int i = 0 ; i < 3 ; i++) {
                    int choix = rand() % 3 + 1;
                    if (choix == vbleu) {
                        rectfill(screen, 240 + i * 110, 240, 340 + i *  110, 340, cbleu);
                    } else if (choix == vblanc) {
                        rectfill(screen, 240 + i * 110, 240, 340 + i *  110, 340, cblanc);
                    } else if (choix == vrouge){
                        rectfill(screen, 240 + i * 110, 240, 340 + i *  110, 340, crouge);
                    }
                }

                if (getpixel(screen, 240, 240) == cblanc && getpixel(screen, 240 + 110, 340) == cblanc && getpixel(screen, 240 + 2*110, 330) == cblanc) {
                    rectfill(screen, 350, 400, 600, 500, cnoir);
                    textprintf_ex(screen,font,350,400,cblanc,-1,"Vous avez gagné");
                    nbrTicket = nbrTicket + 1;
                    rectfill(screen, 300, 500, 700, 530, cnoir); // Efface l'ancien texte
                    textprintf_ex(screen, font, 300, 500, cblanc, -1, "il vous reste %d tickets", nbrTicket); // Affiche le nouveau texte

                } else if (getpixel(screen, 240, 240) == cbleu && getpixel(screen, 240 + 110, 340) == cbleu && getpixel(screen, 240 + 2*110, 330) == cbleu) {
                    rectfill(screen, 350, 400, 600, 500, cnoir);
                    textprintf_ex(screen,font,350,400,cblanc,-1,"Vous avez gagné");
                    nbrTicket = nbrTicket + 1;
                    rectfill(screen, 300, 500, 700, 530, cnoir); // Efface l'ancien texte
                    textprintf_ex(screen, font, 300, 500, cblanc, -1, "il vous reste %d tickets", nbrTicket); // Affiche le nouveau texte

                } else if (getpixel(screen, 240, 240) == crouge && getpixel(screen, 240 + 110, 340) == crouge && getpixel(screen, 240 + 2*110, 330) == crouge) {
                    rectfill(screen, 350, 400, 600, 500, cnoir);
                    textprintf_ex(screen,font,350,400,cblanc,-1,"Vous avez gagné");
                    nbrTicket = nbrTicket + 1;
                    rectfill(screen, 300, 500, 700, 530, cnoir); // Efface l'ancien texte
                    textprintf_ex(screen, font, 300, 500, cblanc, -1, "il vous reste %d tickets", nbrTicket); // Affiche le nouveau texte

                } else {
                    rectfill(screen, 350, 400, 600, 500, cnoir);
                    textprintf_ex(screen,font,350,400,cblanc,-1,"Vous avez perdu");
                    rectfill(screen, 300, 500, 700, 530, cnoir); // Efface l'ancien texte
                    textprintf_ex(screen, font, 300, 500, cblanc, -1, "il vous reste %d tickets", nbrTicket); // Affiche le nouveau texte

                }
            }
        }
    }


    readkey();

    return 0;
}
END_OF_MAIN();
